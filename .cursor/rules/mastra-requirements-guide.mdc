---
description: 
globs: 
alwaysApply: true
---
# Mastraãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯é–‹ç™ºè¦ä»¶å®šç¾©ã‚¬ã‚¤ãƒ‰

## ğŸ“– æ¦‚è¦

ã“ã®ã‚¬ã‚¤ãƒ‰ã¯ã€mastraãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ç”¨ã—ãŸAIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã®è¦ä»¶å®šç¾©æ–¹æ³•ã‚’ã¾ã¨ã‚ãŸã‚‚ã®ã§ã™ã€‚Cursorã§ã®é–‹ç™ºåŠ¹ç‡ã‚’æœ€å¤§åŒ–ã™ã‚‹ãŸã‚ã€å…·ä½“çš„ãªå®Ÿè£…ä¾‹ã¨è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å«ã‚ã¦ã„ã¾ã™ã€‚
# Mastraãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯é–‹ç™ºè¦ä»¶å®šç¾©ã‚¬ã‚¤ãƒ‰

## ğŸ“– æ¦‚è¦

ã“ã®ã‚¬ã‚¤ãƒ‰ã¯ã€mastraãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ç”¨ã—ãŸAIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã®è¦ä»¶å®šç¾©æ–¹æ³•ã‚’ã¾ã¨ã‚ãŸã‚‚ã®ã§ã™ã€‚Cursorã§ã®é–‹ç™ºåŠ¹ç‡ã‚’æœ€å¤§åŒ–ã™ã‚‹ãŸã‚ã€å…·ä½“çš„ãªå®Ÿè£…ä¾‹ã¨è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å«ã‚ã¦ã„ã¾ã™ã€‚

## ğŸ¯ mastraãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¨ã¯

Mastraã¯ã€TypeScriptè£½ã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚ä»¥ä¸‹ã®ä¸»è¦æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ï¼š

- **Agentï¼ˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼‰**: ãƒ¡ãƒ¢ãƒªã¨ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œèƒ½åŠ›ã‚’æŒã¤AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
- **Workflowï¼ˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼‰**: æ±ºå®šè«–çš„ãªLLMå‘¼ã³å‡ºã—ãƒã‚§ãƒ¼ãƒ³
- **Toolï¼ˆãƒ„ãƒ¼ãƒ«ï¼‰**: å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ ã¨ã®é€£æºæ©Ÿèƒ½
- **Memoryï¼ˆãƒ¡ãƒ¢ãƒªï¼‰**: ä¼šè©±å±¥æ­´ã¨çŠ¶æ…‹ã®æ°¸ç¶šåŒ–
- **RAG**: æ–‡æ›¸å‡¦ç†ã¨ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢
- **Evals**: è‡ªå‹•è©•ä¾¡ã¨ãƒ†ã‚¹ãƒˆ

## ğŸ—ï¸ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³

### æ¨å¥¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
src/
â”œâ”€â”€ mastra/
â”‚   â”œâ”€â”€ agents/          # ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®šç¾©
â”‚   â”œâ”€â”€ tools/           # ãƒ„ãƒ¼ãƒ«ãƒ»å¤–éƒ¨é€£æº
â”‚   â”œâ”€â”€ workflows/       # ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®šç¾©
â”‚   â”œâ”€â”€ types/           # å‹å®šç¾©
â”‚   â”œâ”€â”€ config/          # è¨­å®šç®¡ç†
â”‚   â”œâ”€â”€ utils/           # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â””â”€â”€ index.ts         # Mastraã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
â””â”€â”€ server/              # APIãƒ»Webhookã‚µãƒ¼ãƒãƒ¼
```

### åŸºæœ¬çš„ãªMastraã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹è¨­å®š

```typescript
// src/mastra/index.ts
import { Mastra } from "@mastra/core";
import { PinoLogger } from "@mastra/loggers";
import { LibSQLStore } from "@mastra/libsql";
import { agents } from "./agents";
import { workflows } from "./workflows";

export const mastra = new Mastra({
  agents,
  workflows,
  storage: new LibSQLStore({
    url: process.env.NODE_ENV === "production" 
      ? "file:../mastra.db" 
      : ":memory:",
  }),
  logger: new PinoLogger({
    name: "Mastra",
    level: process.env.LOG_LEVEL || "info",
  }),
});
```

## ğŸ¤– ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³

### åŸºæœ¬ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè¨­è¨ˆ

```typescript
// src/mastra/agents/data-analysis-agent.ts
import { Agent } from "@mastra/core/agent";
import { openai } from "@ai-sdk/openai";
import { Memory } from "@mastra/memory";
import { analysisTools } from "../tools/analysis";

export const dataAnalysisAgent = new Agent({
  name: "DataAnalysisAgent",
  description: "ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã—ã€æ´å¯Ÿã‚’æä¾›ã™ã‚‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ",
  instructions: `
    ã‚ãªãŸã¯ãƒ‡ãƒ¼ã‚¿åˆ†æã®å°‚é–€å®¶ã§ã™ã€‚
    ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚Šã€ä»¥ä¸‹ã®è¦³ç‚¹ã§åˆ†æã—ã¦ãã ã•ã„ï¼š
    
    1. ãƒ‡ãƒ¼ã‚¿ã®å“è³ªã¨å®Œå…¨æ€§
    2. ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨å‚¾å‘ã®ç‰¹å®š
    3. ç•°å¸¸å€¤ã®æ¤œå‡º
    4. å®Ÿç”¨çš„ãªæ´å¯Ÿã®æä¾›
    
    å¿…ãšæ§‹é€ åŒ–ã•ã‚ŒãŸå½¢å¼ã§å›ç­”ã—ã¦ãã ã•ã„ã€‚
  `,
  model: openai("gpt-4o"),
  tools: analysisTools,
  memory: new Memory({
    storage: new LibSQLStore({
      url: "file:../memory.db",
    }),
  }),
});
```

### å‹•çš„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè¨­è¨ˆï¼ˆãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå¯¾å¿œï¼‰

```typescript
// src/mastra/agents/dynamic-content-agent.ts
import { Agent } from "@mastra/core/agent";
import { RuntimeContext } from "@mastra/core/di";

type ContentRuntimeContext = {
  "content-type": string;
  "target-audience": string;
  "complexity-level": "beginner" | "intermediate" | "advanced";
};

export const contentGenerationAgent = new Agent({
  name: "ContentGenerationAgent",
  instructions: ({ runtimeContext }) => {
    const complexity = runtimeContext.get("complexity-level");
    const audience = runtimeContext.get("target-audience");
    
    return `
      ã‚ãªãŸã¯ã‚³ãƒ³ãƒ†ãƒ³ãƒ„åˆ¶ä½œã®å°‚é–€å®¶ã§ã™ã€‚
      å¯¾è±¡èª­è€…: ${audience}
      è¤‡é›‘ã•ãƒ¬ãƒ™ãƒ«: ${complexity}
      
      ${complexity === "beginner" 
        ? "åˆ†ã‹ã‚Šã‚„ã™ãåŸºæœ¬çš„ãªèª¬æ˜ã‚’å¿ƒãŒã‘ã¦ãã ã•ã„ã€‚"
        : complexity === "advanced"
        ? "é«˜åº¦ãªæŠ€è¡“çš„è©³ç´°ã‚’å«ã‚ã¦èª¬æ˜ã—ã¦ãã ã•ã„ã€‚"
        : "é©åº¦ãªæŠ€è¡“çš„è©³ç´°ã§èª¬æ˜ã—ã¦ãã ã•ã„ã€‚"
      }
    `;
  },
  model: ({ runtimeContext }) => {
    const complexity = runtimeContext.get("complexity-level");
    return complexity === "advanced" ? openai("gpt-4o") : openai("gpt-4o-mini");
  },
  tools: ({ runtimeContext }) => {
    const baseTools = [contentBasicTools];
    const complexity = runtimeContext.get("complexity-level");
    
    if (complexity === "advanced") {
      baseTools.push(contentAdvancedTools);
    }
    
    return baseTools;
  },
});
```

## ğŸ”§ ãƒ„ãƒ¼ãƒ«è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³

### å¤–éƒ¨APIé€£æºãƒ„ãƒ¼ãƒ«

```typescript
// src/mastra/tools/api-tools.ts
import { createTool } from "@mastra/core/tools";
import { z } from "zod";

export const fetchExternalData = createTool({
  id: "fetch-external-data",
  description: "å¤–éƒ¨APIã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã™",
  inputSchema: z.object({
    endpoint: z.string().describe("APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ"),
    params: z.record(z.any()).optional().describe("ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿"),
  }),
  outputSchema: z.object({
    data: z.any(),
    status: z.number(),
    headers: z.record(z.string()),
  }),
  execute: async ({ context, runtimeContext }) => {
    const apiKey = runtimeContext.get("api-key");
    const { endpoint, params } = context;
    
    // URLæ§‹ç¯‰
    const url = new URL(endpoint);
    if (params) {
      Object.entries(params).forEach(([key, value]) => {
        url.searchParams.append(key, String(value));
      });
    }
    
    const response = await fetch(url.toString(), {
      headers: {
        "Authorization": `Bearer ${apiKey}`,
        "Content-Type": "application/json",
      },
    });
    
    if (!response.ok) {
      throw new Error(`API Error: ${response.statusText}`);
    }
    
    const data = await response.json();
    return {
      data,
      status: response.status,
      headers: Object.fromEntries(response.headers.entries()),
    };
  },
});
```

### ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†ãƒ„ãƒ¼ãƒ«

```typescript
// src/mastra/tools/file-tools.ts
import { createTool } from "@mastra/core/tools";
import { z } from "zod";
import { readFile, writeFile } from "fs/promises";

export const processTextFile = createTool({
  id: "process-text-file",
  description: "ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã€å‡¦ç†ã—ã¾ã™",
  inputSchema: z.object({
    filePath: z.string().describe("ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹"),
  }),
  outputSchema: z.object({
    processedContent: z.string(),
  }),
  execute: async ({ context }) => {
    const filePath = context.filePath;
    const fileContent = await readFile(filePath, "utf-8");
    const processedContent = processContent(fileContent);
    return { processedContent };
  },
});

function processContent(content: string): string {
  // å®Ÿè£…çœç•¥ï¼šãƒ†ã‚­ã‚¹ãƒˆå‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯
  return content;
}
```

## ğŸ”„ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³

### ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

```typescript
// src/mastra/workflows/data-processing.ts
import { createWorkflow, createStep } from "@mastra/core/workflows";
import { z } from "zod";

// ã‚¹ã‚­ãƒ¼ãƒå®šç¾©
const dataInputSchema = z.object({
  source: z.string(),
  format: z.enum(["json", "csv", "xml"]),
  filters: z.record(z.any()).optional(),
});

const processedOutputSchema = z.object({
  processedData: z.array(z.record(z.any())),
  summary: z.object({
    totalRecords: z.number(),
    validRecords: z.number(),
    errors: z.array(z.string()),
  }),
  insights: z.array(z.string()),
});

// ã‚¹ãƒ†ãƒƒãƒ—å®šç¾©
const validateDataStep = createStep({
  id: "validate-data",
  description: "ãƒ‡ãƒ¼ã‚¿ã®å¦¥å½“æ€§ã‚’æ¤œè¨¼",
  inputSchema: dataInputSchema,
  outputSchema: z.object({
    validatedData: z.array(z.record(z.any())),
    validationErrors: z.array(z.string()),
  }),
  execute: async ({ inputData, mastra }) => {
    const agent = mastra.getAgent("dataValidationAgent");
    const result = await agent.generate(
      `ä»¥ä¸‹ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ¤œè¨¼ã—ã¦ãã ã•ã„ï¼š${inputData.source}`
    );
    
    return {
      validatedData: [], // å®Ÿéš›ã®æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯
      validationErrors: [],
    };
  },
});

const processDataStep = createStep({
  id: "process-data",
  description: "ãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç†ãƒ»å¤‰æ›",
  inputSchema: z.object({
    validatedData: z.array(z.record(z.any())),
    validationErrors: z.array(z.string()),
  }),
  outputSchema: z.object({
    processedData: z.array(z.record(z.any())),
    processingMetrics: z.record(z.number()),
  }),
  execute: async ({ inputData, mastra }) => {
    const agent = mastra.getAgent("dataProcessingAgent");
    
    const result = await agent.generate(
      `ãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç†ã—ã¦ãã ã•ã„ï¼š${JSON.stringify(inputData.validatedData)}`
    );
    
    return {
      processedData: inputData.validatedData, // ç°¡ç•¥åŒ–
      processingMetrics: { recordsProcessed: inputData.validatedData.length },
    };
  },
});

const generateInsightsStep = createStep({
  id: "generate-insights",
  description: "ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰æ´å¯Ÿã‚’ç”Ÿæˆ",
  inputSchema: z.object({
    processedData: z.array(z.record(z.any())),
    processingMetrics: z.record(z.number()),
  }),
  outputSchema: processedOutputSchema,
  execute: async ({ inputData, mastra }) => {
    const agent = mastra.getAgent("insightGenerationAgent");
    
    const result = await agent.generate(
      `å‡¦ç†ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‹ã‚‰æ´å¯Ÿã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ï¼š${JSON.stringify(inputData.processedData)}`,
      {
        output: z.object({ insights: z.array(z.string()) }),
      }
    );
    
    return {
      processedData: inputData.processedData,
      summary: {
        totalRecords: inputData.processedData.length,
        validRecords: inputData.processedData.length,
        errors: [],
      },
      insights: result.object?.insights || [],
    };
  },
});

// ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®šç¾©
export const dataProcessingWorkflow = createWorkflow({
  id: "data-processing-workflow",
  description: "ãƒ‡ãƒ¼ã‚¿ã®æ¤œè¨¼ãƒ»å‡¦ç†ãƒ»æ´å¯Ÿç”Ÿæˆã‚’è¡Œã†",
  inputSchema: dataInputSchema,
  outputSchema: processedOutputSchema,
  steps: [validateDataStep, processDataStep, generateInsightsStep],
})
  .then(validateDataStep)
  .then(processDataStep)
  .then(generateInsightsStep)
  .commit();
```

### æ¡ä»¶åˆ†å²ã‚’å«ã‚€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

```typescript
// src/mastra/workflows/conditional-content.ts
export const conditionalContentWorkflow = createWorkflow({
  id: "conditional-content-workflow",
  inputSchema: z.object({
    contentType: z.enum(["article", "tutorial", "documentation"]),
    targetAudience: z.enum(["beginner", "advanced"]),
  }),
  outputSchema: z.object({
    generatedContent: z.string(),
    metadata: z.record(z.any()),
  }),
})
  .then(analyzeContentRequirements)
  .branch([
    // è¨˜äº‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å ´åˆ
    [
      async ({ inputData }) => inputData.contentType === "article",
      generateArticleContent,
    ],
    // ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã®å ´åˆ
    [
      async ({ inputData }) => inputData.contentType === "tutorial",
      generateTutorialContent,
    ],
    // ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®å ´åˆ
    [
      async ({ inputData }) => inputData.contentType === "documentation",
      generateDocumentationContent,
    ],
  ])
  .then(finalizeContent)
  .commit();
```

## ğŸ“ å‹å®šç¾©ãƒ‘ã‚¿ãƒ¼ãƒ³

### å…±é€šãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ã®å‹

```typescript
// src/mastra/types/common.ts
import { z } from "zod";

// åŸºæœ¬ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£å‹
export const BaseEntitySchema = z.object({
  id: z.string(),
  name: z.string(),
  description: z.string().optional(),
  status: z.enum(["active", "inactive", "archived"]),
  tags: z.array(z.string()),
  metadata: z.record(z.any()).optional(),
  createdAt: z.date(),
  updatedAt: z.date(),
});

export type Requirement = z.infer<typeof RequirementSchema>;

// Slackè¦æœ›å‹
export const SlackRequestSchema = z.object({
  messageId: z.string(),
  channel: z.string(),
  userId: z.string(),
  content: z.string(),
  timestamp: z.string(),
  thread: z.string().optional(),
});

export type SlackRequest = z.infer<typeof SlackRequestSchema>;

// GitLabåˆ†æçµæœå‹
export const GitLabAnalysisSchema = z.object({
  projectId: z.string(),
  languages: z.record(z.number()),
  structure: z.object({
    directories: z.array(z.string()),
    mainFiles: z.array(z.string()),
    configFiles: z.array(z.string()),
  }),
  dependencies: z.array(z.string()),
  complexity: z.enum(["low", "medium", "high"]),
  maintainability: z.number().min(0).max(100),
});

export type GitLabAnalysis = z.infer<typeof GitLabAnalysisSchema>;
```

### ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå‹

```typescript
// src/mastra/types/runtime-context.ts
export type RequirementAutomationRuntimeContext = {
  "slack-token": string;
  "gitlab-token": string;
  "project-id": string;
  "user-id": string;
  "analysis-depth": "shallow" | "deep";
  "output-format": "json" | "markdown" | "pdf";
  "language": "ja" | "en";
};
```

## ğŸ§ª ãƒ†ã‚¹ãƒˆè¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³

### ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ†ã‚¹ãƒˆ

```typescript
// tests/agents/requirement-agent.test.ts
import { describe, it, expect, beforeEach } from "@jest/globals";
import { RuntimeContext } from "@mastra/core/di";
import { requirementAgent } from "../../src/mastra/agents/requirement-agent";

describe("RequirementAgent", () => {
  let runtimeContext: RuntimeContext<RequirementAutomationRuntimeContext>;

  beforeEach(() => {
    runtimeContext = new RuntimeContext();
    runtimeContext.set("language", "ja");
    runtimeContext.set("output-format", "json");
  });

  it("should generate functional requirements from Slack message", async () => {
    const message = "ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²æ©Ÿèƒ½ã‚’è¿½åŠ ã—ãŸã„ã€‚ãƒ¡ãƒ¼ãƒ«èªè¨¼ã‚‚å¿…è¦ã€‚";
    
    const result = await requirementAgent.generate(message, {
      runtimeContext,
      output: RequirementSchema,
    });

    expect(result.object).toBeDefined();
    expect(result.object?.type).toBe("functional");
    expect(result.object?.description).toContain("ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²");
  });
});
```

### ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆ

```typescript
// tests/workflows/data-processing.test.ts
import { describe, it, expect } from "@jest/globals";
import { mastra } from "../../src/mastra";

describe("DataProcessingWorkflow", () => {
  it("should complete full data processing flow", async () => {
    const workflow = mastra.getWorkflow("data-processing-workflow");
    const run = workflow.createRun();

    const result = await run.start({
      inputData: {
        source: "test-data.json",
        format: "json",
        filters: { status: "active" },
      },
    });

    expect(result.status).toBe("success");
    expect(result.result?.processedData).toBeDefined();
    expect(result.result?.insights.length).toBeGreaterThan(0);
  });
});
```

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### ç’°å¢ƒå¤‰æ•°ç®¡ç†

```typescript
// src/mastra/config/environment.ts
import { z } from "zod";

const EnvironmentSchema = z.object({
  OPENAI_API_KEY: z.string(),
  API_TOKEN: z.string().optional(),
  EXTERNAL_API_KEY: z.string().optional(),
  DATABASE_URL: z.string(),
  LOG_LEVEL: z.enum(["debug", "info", "warn", "error"]).default("info"),
});

export const env = EnvironmentSchema.parse(process.env);
```

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

```typescript
// src/mastra/utils/error-handling.ts
export class MastraApplicationError extends Error {
  constructor(
    message: string,
    public readonly code: string,
    public readonly context?: Record<string, any>
  ) {
    super(message);
    this.name = "MastraApplicationError";
  }
}

export const handleToolError = (error: unknown, toolId: string) => {
  if (error instanceof MastraApplicationError) {
    console.error(`Tool ${toolId} failed:`, {
      code: error.code,
      message: error.message,
      context: error.context,
    });
    throw error;
  }
  
  throw new MastraApplicationError(
    `Unexpected error in tool ${toolId}`,
    "TOOL_EXECUTION_ERROR",
    { originalError: error }
  );
};
```

## ğŸ“Š ãƒ­ã‚®ãƒ³ã‚°ã¨ç›£è¦–

### æ§‹é€ åŒ–ãƒ­ã‚°

```typescript
// src/mastra/utils/logging.ts
import { PinoLogger } from "@mastra/loggers";

export const logger = new PinoLogger({
  name: "MastraApplication",
  level: process.env.LOG_LEVEL || "info",
  formatters: {
    level: (label) => ({ level: label }),
    log: (object) => ({
      ...object,
      timestamp: new Date().toISOString(),
      service: "mastra-app",
    }),
  },
});

export const logWorkflowStep = (
  stepId: string,
  status: "start" | "success" | "error",
  metadata?: Record<string, any>
) => {
  logger.info("workflow_step", {
    stepId,
    status,
    metadata,
  });
};
```

## ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆè¨­è¨ˆ

### ã‚µãƒ¼ãƒãƒ¼è¨­å®š

```typescript
// src/mastra/index.ts (ã‚µãƒ¼ãƒãƒ¼è¨­å®šä»˜ã)
export const mastra = new Mastra({
  // ... ãã®ä»–ã®è¨­å®š
  server: {
    host: "0.0.0.0",
    port: 4111,
    middleware: [
      // CORSè¨­å®š
      async (c, next) => {
        c.header("Access-Control-Allow-Origin", "*");
        c.header("Access-Control-Allow-Methods", "GET, POST, PUT, DELETE");
        await next();
      },
      // èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
      async (c, next) => {
        const authHeader = c.req.header("Authorization");
        if (!authHeader || !authHeader.startsWith("Bearer ")) {
          return c.json({ error: "Unauthorized" }, 401);
        }
        await next();
      },
    ],
    apiRoutes: [
      {
        path: "/api/data/process",
        method: "POST",
        createHandler: async ({ mastra }) => (c) => {
          const body = await c.req.json();
          const workflow = mastra.getWorkflow("data-processing-workflow");
          const result = await workflow.createRun().start({ inputData: body });
          return c.json(result);
        },
      },
    ],
  },
});
```

## ğŸ“‹ ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### é–‹ç™ºå‰ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] å¿…è¦ãªä¾å­˜é–¢ä¿‚ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹
- [ ] ç’°å¢ƒå¤‰æ•°ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹  
- [ ] å¤–éƒ¨APIãƒ»ã‚µãƒ¼ãƒ“ã‚¹ã®èªè¨¼æƒ…å ±ãŒå–å¾—æ¸ˆã¿
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ãŒé©åˆ‡ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹

### å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®æŒ‡ç¤ºæ–‡ãŒæ˜ç¢ºã§å…·ä½“çš„
- [ ] ãƒ„ãƒ¼ãƒ«ã®ã‚¹ã‚­ãƒ¼ãƒãŒå‹å®‰å…¨ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ã‚¹ãƒ†ãƒƒãƒ—ãŒè«–ç†çš„ã«é…ç½®ã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒé©åˆ‡ã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ãŒç¶²ç¾…çš„ã«æ›¸ã‹ã‚Œã¦ã„ã‚‹

### ãƒ‡ãƒ—ãƒ­ã‚¤å‰ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] æœ¬ç•ªç’°å¢ƒç”¨ã®ç’°å¢ƒå¤‰æ•°ãŒè¨­å®šæ¸ˆã¿
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Œäº†
- [ ] ãƒ­ã‚°ç›£è¦–ãŒè¨­å®šæ¸ˆã¿
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šãŒé©åˆ‡
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆãŒå®Œäº†

## ğŸ“š å‚è€ƒãƒªãƒ³ã‚¯

- [Mastraå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](mdc:https:/mastra.ai/docs)
- [ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè¨­è¨ˆã‚¬ã‚¤ãƒ‰](mdc:https:/mastra.ai/docs/agents/overview)
- [ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼è¨­è¨ˆã‚¬ã‚¤ãƒ‰](mdc:https:/mastra.ai/docs/workflows/overview)
- [ãƒ„ãƒ¼ãƒ«ä½œæˆã‚¬ã‚¤ãƒ‰](mdc:https:/mastra.ai/docs/tools-mcp/overview)

---

ã“ã®ã‚¬ã‚¤ãƒ‰ã‚’å‚è€ƒã«ã€åŠ¹ç‡çš„ã§ä¿å®ˆæ€§ã®é«˜ã„Mastraã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹ç™ºã—ã¦ãã ã•ã„ã€‚ 